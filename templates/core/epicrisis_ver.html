{% extends 'base.html' %}
{% load static %}
{% block title %}Ver Epicrisis{% endblock %}

{% block content %}
<div class="dashboard-container" style="max-width: 1000px; margin: 0 auto;">
    <!-- Header -->
    <div class="card" style="margin-bottom: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2 class="card-header">Epicrisis e Indicaciones Médicas</h2>
            <div style="display: flex; gap: 12px;">
                <a href="{% url 'core:epicrisis_list' %}" class="btn btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                    Volver
                </a>
                <a href="{% url 'core:descargar_epicrisis_pdf' parto.pk %}" class="btn btn-success">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Descargar PDF
                </a>
            </div>
        </div>
    </div>

    <!-- Información del Paciente -->
    <div class="card" style="margin-bottom: 24px;">
        <h3 style="font-size: 18px; font-weight: 600; color: var(--gray-900); margin-bottom: 16px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; color: var(--primary-blue);">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
            Datos del Paciente
        </h3>
        
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px;">
            <div>
                <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Nombre Completo</p>
                <p style="font-size: 15px; font-weight: 600; color: var(--gray-900);">{{ madre.nombre_descifrado }}</p>
            </div>
            <div>
                <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">RUT</p>
                <p style="font-size: 15px; font-weight: 600; color: var(--gray-900);">{{ madre.rut_descifrado }}</p>
            </div>
            <div>
                <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Ficha Clínica</p>
                <p style="font-size: 15px; font-weight: 600; color: var(--gray-900);">{{ madre.ficha_clinica_numero|default:"Sin ficha" }}</p>
            </div>
            <div>
                <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Fecha de Parto</p>
                <p style="font-size: 15px; font-weight: 600; color: var(--gray-900);">{{ parto.fecha_parto|date:"d/m/Y H:i" }}</p>
            </div>
            <div>
                <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Tipo de Parto</p>
                <p style="font-size: 15px; font-weight: 600;">
                    <span class="badge {% if 'Cesárea' in parto.tipo_parto %}badge-yellow{% else %}badge-green{% endif %}">
                        {{ parto.tipo_parto }}
                    </span>
                </p>
            </div>
            <div>
                <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Previsión</p>
                <p style="font-size: 15px; font-weight: 600; color: var(--gray-900);">{{ madre.prevision|default:"Sin previsión" }}</p>
            </div>
        </div>
    </div>

    <!-- Epicrisis -->
    <div class="card" style="margin-bottom: 24px;">
        <h3 style="font-size: 18px; font-weight: 600; color: var(--gray-900); margin-bottom: 16px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; color: var(--primary-blue);">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
            </svg>
            Epicrisis
        </h3>

        {% if epicrisis.motivo_ingreso %}
        <div style="margin-bottom: 20px;">
            <p style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">Motivo de Ingreso:</p>
            <p style="font-size: 14px; color: var(--gray-900); line-height: 1.6;">{{ epicrisis.motivo_ingreso }}</p>
        </div>
        {% endif %}

        <div style="margin-bottom: 20px;">
            <p style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">Resumen de Evolución:</p>
            <p style="font-size: 14px; color: var(--gray-900); line-height: 1.6; white-space: pre-wrap;">{{ epicrisis.resumen_evolucion }}</p>
        </div>

        <div style="margin-bottom: 20px;">
            <p style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">Diagnóstico de Egreso:</p>
            <p style="font-size: 14px; color: var(--gray-900); line-height: 1.6; white-space: pre-wrap;">{{ epicrisis.diagnostico_egreso }}</p>
        </div>

        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 20px;">
            <div>
                <p style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">Condición al Egreso:</p>
                <span class="badge {% if epicrisis.condicion_egreso == 'buena' %}badge-green{% elif epicrisis.condicion_egreso == 'regular' %}badge-yellow{% else %}badge-red{% endif %}" style="font-size: 14px; padding: 6px 12px;">
                    {{ epicrisis.condicion_egreso|title }}
                </span>
            </div>

            {% if epicrisis.control_posterior %}
            <div>
                <p style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">Control Posterior:</p>
                <p style="font-size: 14px; color: var(--gray-900);">{{ epicrisis.control_posterior }}</p>
            </div>
            {% endif %}
        </div>

        {% if epicrisis.indicaciones_alta %}
        <div style="margin-bottom: 20px;">
            <p style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">Indicaciones al Alta:</p>
            <p style="font-size: 14px; color: var(--gray-900); line-height: 1.6; white-space: pre-wrap;">{{ epicrisis.indicaciones_alta }}</p>
        </div>
        {% endif %}

        {% if epicrisis.observaciones %}
        <div style="margin-bottom: 20px;">
            <p style="font-size: 14px; font-weight: 600; color: var(--gray-700); margin-bottom: 8px;">Observaciones:</p>
            <p style="font-size: 14px; color: var(--gray-900); line-height: 1.6; white-space: pre-wrap;">{{ epicrisis.observaciones }}</p>
        </div>
        {% endif %}

        <!-- Información del Médico -->
        <div style="background: #f3f4f6; padding: 16px; border-radius: 8px; margin-top: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Médico Tratante</p>
                    <p style="font-size: 15px; font-weight: 600; color: var(--gray-900);">{{ epicrisis.medico_nombre }}</p>
                </div>
                <div style="text-align: right;">
                    <p style="font-size: 12px; color: var(--gray-600); margin-bottom: 4px;">Fecha de Registro</p>
                    <p style="font-size: 15px; font-weight: 600; color: var(--gray-900);">
                        {{ epicrisis.fecha_creacion|slice:":10" }} {{ epicrisis.fecha_creacion|slice:"11:16" }}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Indicaciones Médicas -->
    {% if indicaciones %}
    <div class="card">
        <h3 style="font-size: 18px; font-weight: 600; color: var(--gray-900); margin-bottom: 16px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; color: var(--primary-green);">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
            Indicaciones Médicas
        </h3>

        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>TIPO</th>
                        <th>DESCRIPCIÓN</th>
                        <th>DOSIS</th>
                        <th>VÍA</th>
                        <th>FRECUENCIA</th>
                    </tr>
                </thead>
                <tbody>
                    {% for indicacion in indicaciones %}
                    <tr>
                        <td>
                            <span class="badge badge-blue">{{ indicacion.get_tipo_display }}</span>
                        </td>
                        <td style="font-weight: 600;">{{ indicacion.descripcion }}</td>
                        <td>{{ indicacion.dosis|default:"-" }}</td>
                        <td>{{ indicacion.via|default:"-" }}</td>
                        <td>{{ indicacion.frecuencia|default:"-" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>

<style>
@media print {
    .btn, .navbar {
        display: none !important;
    }
    .card {
        page-break-inside: avoid;
        box-shadow: none;
        border: 1px solid #e5e7eb;
    }
}
</style>
{% endblock %}