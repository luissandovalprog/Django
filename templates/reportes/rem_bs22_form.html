{% extends 'base.html' %}
{% block title %}Generar Reporte REM{% endblock %}

{% block content %}
<div class="form-container" style="max-width: 800px; margin: 0 auto;">
    
    <div class="alert alert-warning" style="margin-bottom: 24px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
            <line x1="12" y1="9" x2="12" y2="13"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
        </svg>
        <div>
            <strong>Alto Riesgo de Fuga de Datos</strong>
            <p>La generación de reportes consolidados es un privilegio de alto nivel. Toda exportación queda registrada en auditoría.</p>
        </div>
    </div>

    <div class="card">
        <h2 class="card-header">Generar Reporte REM Neonatal</h2>

        <form method="post" id="form-rem-bs22">
            {% csrf_token %}

            <div class="form-grid" style="grid-template-columns: 1fr 1fr;">
                <div class="form-group">
                    <label for="fecha_inicio" class="form-label required">Fecha Inicio</label>
                    <input type="date" 
                           id="fecha_inicio" 
                           name="fecha_inicio"
                           class="form-input"
                           value="2025-10-01"
                           required>
                    <p class="form-hint">Formato: DD/MM/AAAA</p>
                </div>

                <div class="form-group">
                    <label for="fecha_fin" class="form-label required">Fecha Fin</label>
                    <input type="date" 
                           id="fecha_fin" 
                           name="fecha_fin"
                           class="form-input"
                           value="2025-11-06"
                           required>
                    <p class="form-hint">Formato: DD/MM/AAAA</p>
                </div>
            </div>

            <div class="btn-group">
                <a href="{% url 'reportes:menu' %}" class="btn btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"/>
                    </svg>
                    Volver
                </a>
                <button type="submit" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 6 2 18 2 18 9"/>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                        <rect x="6" y="14" width="12" height="8"/>
                    </svg>
                    Generar Reporte REM
                </button>
            </div>
        </form>
    </div>
</div>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('form-rem-bs22');
    
    if (form) {
        form.addEventListener('submit', function(e) {
            const fechaInicio = document.getElementById('fecha_inicio').value;
            const fechaFin = document.getElementById('fecha_fin').value;
            
            if (!fechaInicio || !fechaFin) {
                e.preventDefault();
                alert('Por favor, seleccione ambas fechas');
                return false;
            }
            
            // Validar que fecha inicio sea menor que fecha fin
            if (new Date(fechaInicio) > new Date(fechaFin)) {
                e.preventDefault();
                alert('La fecha de inicio debe ser anterior a la fecha de fin');
                return false;
            }
            
            // Mostrar loading
            const btnSubmit = this.querySelector('button[type="submit"]');
            if (btnSubmit) {
                btnSubmit.disabled = true;
                btnSubmit.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="spin"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg> Generando PDF...';
            }
        });
    }
});
</script>

<style>
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.spin {
    animation: spin 1s linear infinite;
}
</style>
{% endblock %}
{% endblock %}